<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Stage 3 — Preview (Uci)</title>
  <link rel="stylesheet" href="spotify-gift/assets/css/style.css">
  <script src="spotify-gift/assets/js/common.js" defer></script>
<!-- improve Android chrome look & install feel -->
<meta name="theme-color" content="#07102a">
<meta name="mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<link rel="icon" href="spotify-gift/assets/monk.png"> <!-- optional: add a small favicon -->


</head>
<body>
  <div class="container" style="display:flex;gap:28px;align-items:center;flex-wrap:wrap">
    <div style="flex:1;min-width:300px">
      <div style="display:flex;gap:18px;align-items:center">
  <div class="avatar" id="album" aria-hidden="true" style="background-image:url('spotify-gift/uci.jpg');">
    <div class="avatar-ring" aria-hidden="true"></div>
  </div>
  <div style="flex:1">
    <h2 style="margin:0">Quick preview — made for <span class="neon-name">Uci</span></h2>
    <p class="muted" id="vibeText">Loading your picks...</p>
    <div style="margin-top:12px" class="spectrum" id="spectrum"></div>
  </div>
</div>


      <div style="margin-top:20px;display:flex;gap:12px;flex-wrap:wrap">
        <button id="openGift" class="btn big">Open Gift — Reveal</button>
        <button id="backToVibes" class="btn ghost">Back</button>
        <button id="miniConfetti" class="btn ghost">Tiny confetti</button>
      </div>
    </div>

    <div style="width:360px;min-width:220px">
      <div style="padding:18px;border-radius:12px;background:var(--card)">
        <h4 style="margin:0">Playlist for Uci</h4>
        <div id="playlistCards" style="margin-top:12px"></div>
      </div>
    </div>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', function(){
      const album = document.getElementById('album');
      const spectrum = document.getElementById('spectrum');
      const openGift = document.getElementById('openGift');
      const backToVibes = document.getElementById('backToVibes');
      const playlistCards = document.getElementById('playlistCards');
      const vibeText = document.getElementById('vibeText');
      const miniConfetti = document.getElementById('miniConfetti');

      // create spectrum bars
      for(let i=0;i<14;i++){
        const b = document.createElement('div');
        b.style.height = (6 + Math.random()*80) + 'px';
        b.style.width = (100/14) + '%';
        b.style.flex = '1';
        b.style.borderRadius = '6px';
        b.style.background = 'linear-gradient(180deg,var(--yellow-1),#fff)';
        spectrum.appendChild(b);
      }

      // spin album when ready
      album.classList.add('spin');

      // read selected genres from sessionStorage
      const sel = JSON.parse(sessionStorage.getItem('sg_selected') || '[]');
      vibeText.textContent = sel.length ? 'Vibe: ' + sel.join(', ') : 'Vibe: Surprise mix';

      const samples = {
        pop:[['Blinding Lights','The Weeknd'],['Levitating','Dua Lipa'],['As It Was','Harry Styles']],
        hiphop:[['SICKO MODE','Travis Scott'],['Gods Plan','Drake'],['HUMBLE.','Kendrick Lamar']],
        rock:[['Mr. Brightside','The Killers'],['Take Me Out','Franz Ferdinand'],['Creep','Radiohead']],
        edm:[['Titanium','David Guetta'],['Wake Me Up','Avicii'],['Strobe','deadmau5']],
        classical:[['Clair de Lune','Debussy'],['Nocturne op.9 No.2','Chopin'],['Spring (Four Seasons)','Vivaldi']],
        surprise(){ return [this.pop[0], this.edm[0], this.rock[0]] }
      };

      function buildPlaylist(){
        let pl = [];
        if(!sel || sel.length===0) pl = pl.concat(samples.surprise());
        else {
          sel.forEach(g=>{
            if(g==='surprise') pl = pl.concat(samples.surprise());
            else if(samples[g]) pl = pl.concat(samples[g]);
          });
        }
        pl = pl.slice(0,6);
        playlistCards.innerHTML = '';
        pl.forEach((t,i)=> {
          const div = document.createElement('div');
          div.className = 'card';
          div.style.marginBottom = '8px';
          div.innerHTML = '<strong>' + esc(t[0]) + '</strong><div class=\"muted\">' + esc(t[1]) + '</div>';
          playlistCards.appendChild(div);
        });
      }

      // animate spectrum periodically
      setInterval(()=> {
        Array.from(spectrum.children).forEach(ch => {
          ch.style.height = (6 + Math.random() * 90) + 'px';
        });
      }, 260);

      buildPlaylist();

      openGift.addEventListener('click', function(){
        window.ConfettiSystem.start({count:260, duration:3600});
        album.style.transform = 'scale(1.08)';
        setTimeout(()=> album.style.transform = '', 700);
        setTimeout(()=> window.goTo('reveal.html'), 1200);
      });

      backToVibes.addEventListener('click', ()=> window.goTo('stage2.html'));

      miniConfetti.addEventListener('click', ()=> window.ConfettiSystem.start({count:90,duration:1800}));

      document.addEventListener('keydown', (e)=> { if(e.key === 'g') openGift.click(); });
    });
  </script>
</body>
</html>

